From db77399069c784f1019e01bb06ec24d7c0d8a16b Mon Sep 17 00:00:00 2001
From: Quoc Ngo <quoc.ngo.wz@rvc.renesas.com>
Date: Wed, 29 Nov 2017 13:11:42 +0700
Subject: [PATCH] Fix app hidden under weston taskbar after restore down

Set app position always under weston taskbar

Signed-off-by: Quoc Ngo <quoc.ngo.wz@rvc.renesas.com>
---
 desktop-shell/shell.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/desktop-shell/shell.c b/desktop-shell/shell.c
index 5b71bc2..519a093 100644
--- a/desktop-shell/shell.c
+++ b/desktop-shell/shell.c
@@ -280,6 +280,8 @@ static void
 shell_surface_set_parent(struct shell_surface *shsurf,
                          struct weston_surface *parent);
 
+int32_t panel_height_change = 0;
+
 static int
 shell_surface_get_label(struct weston_surface *surface, char *buf, size_t len)
 {
@@ -2848,7 +2850,7 @@ set_surface_type(struct shell_surface *shsurf)
 
 		weston_view_set_position(shsurf->view,
 		shsurf->transient.x,
-		shsurf->transient.y);
+		shsurf->transient.y + panel_height_change);
 		break;
 
 	case SHELL_SURFACE_XWAYLAND:
@@ -5591,6 +5593,8 @@ weston_view_set_initial_position(struct weston_view *view,
    get_output_panel_size(shell, output, &panel_width, &panel_height);
 	get_output_work_area(shell, target_output, &area);
 
+	panel_height_change = panel_height;
+
 	x = area.x;
 	y = area.y;
 	range_x = area.width - view->surface->width;
-- 
1.9.1

