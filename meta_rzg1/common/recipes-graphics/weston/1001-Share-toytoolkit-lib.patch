From af070d19ee1de7da70b0892276b114eadf5c5bbd Mon Sep 17 00:00:00 2001
From: TungDang <tung.dang.jy@rvc.renesas.com>
Date: Tue, 6 Sep 2016 19:37:13 +0700
Subject: [PATCH] Share toytoolkit lib

Signed-off-by: Andrey Gusakov <andrey.gusakov@cogentembedded.com>
Update-by: TungDang <tung.dang.jy@rvc.renesas.com>
---
 Makefile.am  | 36 +++++++++++++++++++++++++++++++-----
 configure.ac |  2 +-
 2 files changed, 32 insertions(+), 6 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index d2528ac..3e3f4f8 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -6,6 +6,7 @@ libexec_PROGRAMS =
 moduledir = $(libdir)/weston
 module_LTLIBRARIES =
 noinst_LTLIBRARIES =
+lib_LTLIBRARIES =
 BUILT_SOURCES =

 AM_DISTCHECK_CONFIGURE_FLAGS = --disable-setuid-install
@@ -189,15 +190,15 @@ wayland_sessiondir = $(datadir)/wayland-sessions
 dist_wayland_session_DATA = src/weston.desktop

 westonincludedir = $(includedir)/weston
-westoninclude_HEADERS =				\
+westoninclude_HEADERS =			\
	src/version.h				\
	src/compositor.h			\
-	src/timeline-object.h			\
+	src/timeline-object.h		\
	shared/matrix.h				\
-	shared/config-parser.h			\
+	shared/config-parser.h		\
	shared/zalloc.h				\
-	shared/platform.h
-
+	shared/platform.h           \
+    clients/window.h
 if ENABLE_EGL
 module_LTLIBRARIES += gl-renderer.la
 gl_renderer_la_LDFLAGS = -module -avoid-version
@@ -574,6 +575,31 @@ libtoytoolkit_la_LIBADD =			\
	libshared-cairo.la -lrt -lm
 libtoytoolkit_la_CFLAGS = $(AM_CFLAGS) $(CLIENT_CFLAGS) $(CAIRO_EGL_CFLAGS)

+lib_LTLIBRARIES += libweston-toytoolkit.la
+
+libweston_toytoolkit_la_SOURCES =  \
+   clients/window.c                \
+   clients/window.h                \
+   protocol/text-cursor-position-protocol.c    \
+   protocol/text-cursor-position-client-protocol.h \
+   protocol/scaler-protocol.c          \
+   protocol/scaler-client-protocol.h       \
+   protocol/workspaces-protocol.c          \
+   protocol/workspaces-client-protocol.h       \
+   protocol/xdg-shell-protocol.c           \
+   protocol/xdg-shell-client-protocol.h
+
+BUILT_SOURCES += $(libweston_toytoolkit_la_SOURCES)
+
+libweston_toytoolkit_la_CFLAGS = \
+   $(AM_CFLAGS) $(CLIENT_CFLAGS) $(CAIRO_EGL_CFLAGS) \
+   $(GCC_CFLAGS) -pthread -fvisibility=default
+libweston_toytoolkit_la_LIBADD =           \
+   $(CLIENT_LIBS)              \
+   $(CAIRO_EGL_LIBS)           \
+   libshared-cairo.la -lrt -lm
+libweston_toytoolkit_la_LDFLAGS = -version-info 1:0:1
+
 weston_flower_SOURCES = clients/flower.c
 weston_flower_LDADD = libtoytoolkit.la
 weston_flower_CFLAGS = $(AM_CFLAGS) $(CLIENT_CFLAGS)
diff --git a/configure.ac b/configure.ac
index b9ada8b..dff57d7 100644
--- a/configure.ac
+++ b/configure.ac
@@ -43,7 +43,7 @@ AC_PROG_SED

 # Initialize libtool
 LT_PREREQ([2.2])
-LT_INIT([disable-static])
+LT_INIT([shared static])

 AC_ARG_VAR([WESTON_NATIVE_BACKEND],
            [Set the native backend to use, if Weston is not running under Wayland nor X11. @<:@default=drm-backend.so@:>@])
--
1.9.1
